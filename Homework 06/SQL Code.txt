CREATE MODEL
  `main-form-308204.Supermarket.kmean2`
OPTIONS
  ( MODEL_TYPE='KMEANS',
    NUM_CLUSTERS=3,
    KMEANS_INIT_METHOD='RANDOM') AS
(SELECT
MAX(SHOP_DATE) AS LAST_VISIT,
COUNT(DISTINCT BASKET_ID) AS TOTAL_VISIT,
SUM(SPEND) AS TOTAL_SPEND,
COUNT(DISTINCT BASKET_ID)/COUNT(DISTINCT SHOP_WEEK) AS AVG_WEEKLY_VISIT,
SUM(SPEND)/COUNT(DISTINCT SHOP_WEEK) AS AVG_WEEKLY_SPEND,
SUM(SPEND)/COUNT(DISTINCT BASKET_ID) AS AVG_BASKET_SIZE
FROM
`main-form-308204.Supermarket.Supermarket`
WHERE
CUST_CODE IS NOT NULL
GROUP BY
CUST_CODE)